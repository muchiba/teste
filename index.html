// Arquivo: Agenda.jsx (componente React)

import React, { useState, useEffect } from 'react';
import axios from 'axios';
import io from 'socket.io-client';

const socket = io('http://localhost:3000');

function Agenda() {
  const [agendamentos, setAgendamentos] = useState([]);
  const usuarioId = 'ID_DO_USUARIO_LOGADO'; // ID do usuário logado (paciente, médico, etc.)

  // Função para buscar agendamentos
  const buscarAgendamentos = async () => {
    try {
      const response = await axios.get(`http://localhost:3000/api/agenda/${usuarioId}`);
      setAgendamentos(response.data);
    } catch (error) {
      console.error('Erro ao buscar agendamentos:', error);
    }
  };

  useEffect(() => {
    buscarAgendamentos();

    // Ouvinte para novos agendamentos via WebSocket
    socket.on('novoAgendamento', (data) => {
      console.log('Alerta de novo agendamento:', data.mensagem);
      buscarAgendamentos(); // Atualiza a lista de agendamentos
    });

    // Limpeza do ouvinte ao desmontar o componente
    return () => socket.off('novoAgendamento');
  }, []);

  return (
    <div>
      <h2>Minha Agenda</h2>
      <ul>
        {agendamentos.map(ag => (
          <li key={ag.id}>
            {ag.data} - {ag.descricao}
          </li>
        ))}
      </ul>
    </div>
  );
}

export default Agenda;
