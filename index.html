<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    /* overlay que cobre a tela e pisca em vermelho */
    #flash {
      position: fixed;
      inset: 0;
      background: red;
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
    }

    /* animação de piscar: opacidade sobe e desce */
    @keyframes piscarVermelho {
      0%   { opacity: 0; }
      50%  { opacity: 0.6; }
      100% { opacity: 0; }
    }

    /* quando o body recebe a classe alerta, o overlay anima */
    body.alerta #flash {
      animation: piscarVermelho 0.8s linear infinite;
    }
  </style>
</head>
<body style="font-size: 100%;">

<!-- overlay para o piscar -->
<div id="flash"></div>

<div class="container-fluid mt-3" style="font-size: 18.5em;">
  <h1></h1>
  <div class="row">    
    <div class="col p-6 text-end" id="min" style="padding-right: 0!important;">00: </div>
    <div class="col p-6" id="seg" style="padding-left: 0!important;">00</div>
 </div>
</div>

<div class="container-fluid">
  <div class="row">    
    <div class="col p-3 text-center" style="padding-left: 0!important; padding-right: 70px!important;">
      <button onclick="setSecondsFunction(300)" class="btn btn-lg btn-primary botao-tempo">+ 5 minutos</button>
      <button onclick="setSecondsFunction(180)" class="btn btn-lg btn-primary botao-tempo">+ 3 minutos</button>
      <button onclick="setSecondsFunction(60)" class="btn btn-lg btn-primary botao-tempo">+ 1 minuto</button>
      <button onclick="setSecondsFunction(30)" class="btn btn-lg btn-primary botao-tempo">+ 30 segundos</button>
    </div>
  </div>
  <div class="row">    
    <div class="col p-3 text-center" style="padding-left: 0!important; padding-right: 70px!important;">
      <button onclick="setSecondsFunction(-300)" class="btn btn-lg btn-warning botao-tempo">- 5 minutos</button>
      <button onclick="setSecondsFunction(-180)" class="btn btn-lg btn-warning botao-tempo">- 3 minutos</button>
      <button onclick="setSecondsFunction(-60)" class="btn btn-lg btn-warning botao-tempo">- 1 minuto</button>
      <button onclick="setSecondsFunction(-30)" class="btn btn-lg btn-warning botao-tempo">- 30 segundos</button>
    </div>
  </div>
  <div class="row">    
    <div class="col p-3 text-end"><button onclick="stopFunction()" class="btn btn-lg btn-danger botao-tempo"> Parar</button></div>
    <div class="col p-3" style="padding-left: 0!important; padding-right: 85px!important;">
      <button onclick="pauseFunction(0)" id="pause" class="btn btn-lg btn-info botao-controle"> Pausar</button>
      <button onclick="pauseFunction(1)" id="continue" style="display: none" class="btn btn-lg btn-info botao-controle"> Continue</button>
    </div>
  </div>
</div>

<script>
var seconds = 0;
var minutes = 0;
var myVar;
var pausado = 0;

function setSecondsFunction(sec){
  if ((sec < 0) && (minutes > 0)){
      seconds += minutes * 60;
      minutes = 0;
      seconds += sec;
  }else{
    seconds += sec;  
  }  
  console.log("seconds (total):", seconds);
  clearInterval(myVar);
  myVar = setInterval(myTimer, 1000);
  // dispara imediatamente uma vez para atualizar a UI sem esperar 1s
  myTimer();
}

function myTimer() {

  if (seconds >= 60){
    minutes += Math.floor(seconds/60);
    seconds = Math.round((seconds/60 - Math.floor(seconds/60))*60);    
  }
  
  if (minutes < 10){
    document.getElementById("min").innerHTML = "0" + minutes + ": ";
  }else{
    document.getElementById("min").innerHTML = minutes + ": ";
  }

  if (seconds < 10){
    document.getElementById("seg").innerHTML = " 0" + seconds;
  }else{
    document.getElementById("seg").innerHTML = seconds;
  }

  if (minutes > 0 && seconds == 0){
    minutes--;
    seconds = 60;
  }
  if ((minutes == 0 && seconds <= 0) || seconds < 0){
    stopFunction();
    return;
  }

  // se faltar menos de 10 segundos → adiciona classe que ativa o overlay
  if (minutes === 0 && seconds < 10 && seconds >= 0){
    document.body.classList.add("alerta");
  } else {
    document.body.classList.remove("alerta");
  }

  // decrementa só se não estiver pausado
  if (pausado == 0){
      seconds -= 1;
  }    
}

function stopFunction() {
  clearInterval(myVar);  
  document.location.reload(true);  
}

function pauseFunction(valor) {  
  if (!(minutes == 0 && seconds == 0)){
    clearInterval(myVar);
    if (seconds >= 60){
      minutes += Math.floor(seconds/60);
      seconds = Math.round((seconds/60 - Math.floor(seconds/60))*60);    
    }

    if (minutes < 10){
      document.getElementById("min").innerHTML = "0" + minutes + ": ";
    }else{
      document.getElementById("min").innerHTML = minutes + ": ";
    }

    if (seconds < 10){
      document.getElementById("seg").innerHTML = " 0" + seconds;
    }else{
      document.getElementById("seg").innerHTML = seconds;
    }

    switch (valor){
      case 0:
        // Pausar: remove o piscar se estiver ativo
        console.log("Pause");
        document.getElementById("continue").style.display = "inline-block";
        document.getElementById("pause").style.display = "none";
        pausado = 1;
        document.body.classList.remove("alerta");
        break;
      case 1:
        // Continuar
        console.log("Continue");
        document.getElementById("continue").style.display = "none";
        document.getElementById("pause").style.display = "inline-block";
        pausado = 0;
        setSecondsFunction(0); // reinicia intervalo
        break;  
    }
  }  
}
</script>

</body>
</html>
